<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><title>RSpec 3.2 has been released!</title><link href="/stylesheets/application.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/pages/blog.css" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="blog"><header><nav><h1><a href="/">RSpec</a></h1><ul><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><section><article class="blog_post"><h1>RSpec 3.2 has been released!</h1><h3 class="author">Myron Marston</h3><small class="date">Feb  3, 2015</small><p>RSpec 3.2 has just been released! Given our commitment to
<a href="http://semver.org/">semantic versioning</a>, this should be a trivial
upgrade for anyone already using RSpec 3.0 or 3.1, but if we did introduce
any regressions, please let us know, and we'll get a patch release
out with a fix ASAP.</p>

<p>RSpec continues to be a community-driven project with contributors
from all over the world. This release includes 915 commits and 278
merged pull requests from over 50 different contributors!</p>

<p>Thank you to everyone who helped make this release happen!</p>

<h2 id="notable-changes">Notable Changes</h2>

<h3 id="windows-ci">Windows CI</h3>

<p>RSpec has always supported Windows, but the fact that all the core
maintainers develop on POSIX systems has occasionally made that
difficult. When RSpec 3.1 was released, we unfortunately broke
a couple things on Windows without knowing about it until some
users reported the issues (which were later fixed in 3.1.x patch
releases). We'd like to prevent that from happening again, so
this time around we've put effort into getting Windows CI builds
going on <a href="http://www.appveyor.com/">AppVeyor</a>.</p>

<p>We have passing Windows builds, but there's still more to do here.
If you're an RSpec and Windows user and would like to help us out,
please get in touch!</p>

<h3 id="core-pending-example-output-includes-failure-details">Core: Pending Example Output Includes Failure Details</h3>

<p>RSpec 3.0 shipped with new semantics for <code>pending</code>.  Rather than
skipping the example (now available using <code>skip</code>), pending examples
are executed with an expectation that a failure will occur, and, if
there is no failure, they'll fail to notify you that they no longer
need to be marked as <code>pending</code>.  This change is quite useful, as it
ensures that every <code>pending</code> example needs to be pending.  However,
the formatter output didn't indicate the failure that forced the
example to remain pending, so you had to un-pend the example to see
that detail.</p>

<p>In RSpec 3.2, we've rectified this: <code>pending</code> example output now
includes the failure that occurred while executing the example.</p>

<h3 id="core-each-example-now-has-a-singleton-group">Core: Each Example Now Has a Singleton Group</h3>

<p>RSpec has a number of metadata-based features that, before now,
would only apply to example groups, not individual examples:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># 1. Filtered module inclusion: examples in groups tagged with `:uses_time`</span>
  <span class="c1">#    will have access to the instance methods of `TimeHelpers`</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">TimeHelpers</span><span class="p">,</span> <span class="ss">:uses_time</span>

  <span class="c1"># 2. Context hooks: a browser will start before groups tagged</span>
  <span class="c1">#    with `:uses_browser` and shutdown afterwards.</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:context</span><span class="p">,</span> <span class="ss">:uses_browser</span><span class="p">)</span> <span class="p">{</span> <span class="no">Browser</span><span class="p">.</span><span class="nf">start</span> <span class="p">}</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">after</span><span class="p">(</span> <span class="ss">:context</span><span class="p">,</span> <span class="ss">:uses_browser</span><span class="p">)</span> <span class="p">{</span> <span class="no">Browser</span><span class="p">.</span><span class="nf">shutdown</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># 3. Shared context auto-inclusion: groups tagged with</span>
<span class="c1">#    `:uses_redis` will have this context included.</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">shared_context</span> <span class="s2">"Uses Redis"</span><span class="p">,</span> <span class="ss">:uses_redis</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:redis</span><span class="p">)</span> <span class="p">{</span> <span class="no">Redis</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'REDIS_URL'</span><span class="p">])</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">redis</span><span class="p">.</span><span class="nf">flushdb</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>In each of these cases, individual examples tagged with the
appropriate metadata would not have these constructs applied to them,
which could be easy to forget. That's changing in RSpec 3.2: we now
treat every example as being implicitly part of a singleton example
group of just one example, and that allows us to apply these constructs
to individual examples, and not just groups. If you're familiar with
Ruby's object model, this may sound familiar – every object in Ruby
has a singleton class that holds custom behavior that applies to that
instance only. This feature was trivially implemented on top of Ruby's
singleton classes.</p>

<h3 id="core-performance-improvements">Core: Performance Improvements</h3>

<p>We put some significant effort into optimizing rspec-core's performance
for RSpec 3.2. Besides some algorithmic changes and numerous micro-optimizations,
we also found ways to greatly reduce the number of object allocations
done by rspec-core. According to <a href="https://gist.github.com/myronmarston/5de3daf2cfaf07a73e6b">my
benchmarks</a>, RSpec 3.2 allocates
~30% fewer objects than RSpec 3.1, all while gaining numerous new features.</p>

<p>In future releases, I'm hoping we can apply similar improvements
to rspec-expectations and rspec-mocks.</p>

<h3 id="core-new-sandboxing-api">Core: New Sandboxing API</h3>

<p>RSpec is tested using RSpec. In rspec-core, many of the specs in our
spec suite define and run example groups and examples to verify the
behavior of how RSpec's various constructs relate when when run in
a real RSpec context. To facilitate this dog-fooding, rspec-core's
spec suite has long used a <em>sandboxing</em> technique. Each spec
is free to mutate configuration and define example groups and examples
without worrying about how that could interfere with the RSpec runner's
internal state.</p>

<p>This sandboxing is obviously useful for RSpec's own internal use, but
it's also useful for testing 3rd party RSpec extensions. We now offer
it as a new public API:</p>

<pre class="highlight ruby"><code><span class="c1"># You have to require this file to make this API available...</span>
<span class="nb">require</span> <span class="s1">'rspec/core/sandbox'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">around</span> <span class="k">do</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span>
    <span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Sandbox</span><span class="p">.</span><span class="nf">sandboxed</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to Tyler Ball for <a href="https://github.com/rspec/rspec-core/pull/1808">implementing
this</a>.</p>

<h3 id="core-shared-example-group-improvements">Core: Shared Example Group Improvements</h3>

<p>In this release we fixed several long-standing bugs and annoyances
with shared example groups:</p>

<ul>
  <li>Failures from examples defined in shared groups now include a full
shared example group inclusion backtrace so you can pinpoint the
exact inclusion that contains the failure. <a href="https://github.com/rspec/rspec-core/pull/1763">#1763</a></li>
  <li>The re-run command printed for a shared example group failure
should now always work to re-run the failed example (although it
may run additional examples, too). <a href="https://github.com/rspec/rspec-core/pull/1835">#1835</a></li>
  <li>Location filtering applied to a shared example now works properly
for some odd edge cases where it previously failed. <a href="https://github.com/rspec/rspec-core/pull/1837">#1837</a></li>
</ul>

<p>If you've had issues with shared example groups in the past due to
issues like these, you may want to give them another try.</p>

<h3 id="expectations-chain-shorthand-for-dsl-defined-custom-matchers">Expectations: Chain Shorthand For DSL-Defined Custom Matchers</h3>

<p>The custom matcher DSL has a <code>chain</code> method that makes it easy to
add fluent interfaces to your matchers:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:be_bigger_than</span> <span class="k">do</span> <span class="o">|</span><span class="n">min</span><span class="o">|</span>
  <span class="n">chain</span> <span class="ss">:but_smaller_than</span> <span class="k">do</span> <span class="o">|</span><span class="n">max</span><span class="o">|</span>
    <span class="vi">@max</span> <span class="o">=</span> <span class="n">max</span>
  <span class="k">end</span>

  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="n">value</span> <span class="o">&gt;</span> <span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="vi">@max</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># usage:</span>
<span class="n">expect</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_bigger_than</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nf">but_smaller_than</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</code></pre>

<p>As this example shows, the most common use of <code>chain</code> it to accept an
additional argument that is used in the <code>match</code> logic somehow. Tom
Stuart <a href="https://github.com/rspec/rspec-expectations/pull/644">suggested and
implemented</a> an
improvement that allows you to shorten the matcher definition to:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:be_bigger_than</span> <span class="k">do</span> <span class="o">|</span><span class="n">min</span><span class="o">|</span>
  <span class="n">chain</span> <span class="ss">:but_smaller_than</span><span class="p">,</span> <span class="ss">:max</span>
  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="n">value</span> <span class="o">&gt;</span> <span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">max</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>The second argument to <code>chain</code> – <code>:max</code> – is used to define a <code>max</code>
attribute that gets set to the argument passed to <code>but_smaller_than</code>.</p>

<p>Thanks, Tom Stuart!</p>

<h3 id="expectations-output-matchers-can-handle-subprocesses">Expectations: Output Matchers Can Handle Subprocesses</h3>

<p>RSpec 3.0 shipped with a new <code>output</code> matcher that allows you to specify
expected output to either <code>stdout</code> or <code>stderr</code>:</p>

<pre class="highlight ruby"><code><span class="n">expect</span> <span class="p">{</span> <span class="nb">print</span> <span class="s1">'foo'</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">).</span><span class="nf">to_stdout</span>
<span class="n">expect</span> <span class="p">{</span> <span class="nb">warn</span>  <span class="s1">'foo'</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="sr">/foo/</span><span class="p">).</span><span class="nf">to_stderr</span>
</code></pre>

<p>The mechanism used for these matchers – temporarily replacing <code>$stdout</code>
or <code>$stderr</code> with a <code>StringIO</code> for the duration of the block – is pretty simple but does
not work when you spawn subprocesses that output to one of these
streams. For example, this fails:</p>

<pre class="highlight ruby"><code><span class="n">expect</span> <span class="p">{</span> <span class="nb">system</span><span class="p">(</span><span class="s1">'echo foo'</span><span class="p">)</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="s2">"foo</span><span class="se">\n</span><span class="s2">"</span><span class="p">).</span><span class="nf">to_stdout</span>
</code></pre>

<p>In RSpec 3.2, you can replace <code>to_stdout</code> with
<code>to_stdout_from_any_process</code> and this expectation will work.</p>

<pre class="highlight ruby"><code><span class="n">expect</span> <span class="p">{</span> <span class="nb">system</span><span class="p">(</span><span class="s1">'echo foo'</span><span class="p">)</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="s2">"foo</span><span class="se">\n</span><span class="s2">"</span><span class="p">).</span><span class="nf">to_stdout_from_any_process</span>
</code></pre>

<p>This uses an alternate mechanism, where <code>$stdout</code> is temporarily
reopened to a temp file, that works with subprocesses. Unfortunately,
it's also much, much slower – in our
<a href="https://github.com/rspec/rspec-expectations/blob/v3.2.0/benchmarks/output_stringio_vs_tempfile.rb">benchmark</a>,
it's 30 times slower! For this reason, you have to opt-in to it using
<code>to_std(out|err)_from_any_process</code> in place of <code>to_std(out|err)</code>.</p>

<p>Thanks to Alex Genco for
<a href="https://github.com/rspec/rspec-expectations/pull/700">implementing</a> this improvement!</p>

<h3 id="expectations-dsl-defined-custom-matchers-can-now-receive-blocks">Expectations: DSL-Defined Custom Matchers Can Now Receive Blocks</h3>

<p>When defining a custom matcher using the DSL, there are situations
where it would be nice to accept a block:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:be_sorted_by</span> <span class="k">do</span> <span class="o">|&amp;</span><span class="n">blk</span><span class="o">|</span>
  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">array</span><span class="o">|</span>
    <span class="n">array</span><span class="p">.</span><span class="nf">each_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">all?</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span>
      <span class="p">(</span><span class="n">blk</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="n">blk</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># intended usage:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">users</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_sorted_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:email</span><span class="p">)</span>
</code></pre>

<p>Unfortunately, Ruby restrictions do not allow us to support this. The
<code>define</code> block is executed using <code>class_exec</code>, which ensures it is
evaluated in the context of a new matcher class, while also allowing us
to forward arguments from the call site to the <code>define</code> block. The block
passed to <code>class_exec</code> is the one to be evaluated (in this case, the
<code>define</code> block) and there is no way to pass two blocks to <code>class_exec</code>.</p>

<p>In prior versions of RSpec, the block passed to <code>be_sorted_by</code> would be
silently ignored. In RSpec 3.2, we now issue a warning:</p>

<pre class="highlight plaintext"><code>WARNING: Your `be_sorted_by` custom matcher receives a block argument (`blk`), but
due to limitations in ruby, RSpec cannot provide the block. Instead, use the
`block_arg` method to access the block. Called from path/to/file.rb:line_number.
</code></pre>

<p>…which tells you an alternate way to accomplish this: the new <code>block_arg</code>
method, available from within a custom matcher:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:be_sorted_by</span> <span class="k">do</span>
  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">array</span><span class="o">|</span>
    <span class="n">array</span><span class="p">.</span><span class="nf">each_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">all?</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span>
      <span class="p">(</span><span class="n">block_arg</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="n">block_arg</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to Mike Dalton for
<a href="https://github.com/rspec/rspec-expectations/pull/645">implementing</a> this improvement.</p>

<h3 id="mocks-anyargs-works-as-an-arg-splat">Mocks: <code>any_args</code> Works as an Arg Splat</h3>

<p>RSpec has had an <code>any_args</code> matcher for a long time:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">(</span><span class="n">test_double</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">any_args</span><span class="p">)</span>
</code></pre>

<p>The <code>any_args</code> matcher behaves exactly like it reads: it allows any
arguments (including none) to match the message expectation. In RSpec
3.1 and before, <code>any_args</code> could only be used as a stand-alone argument
to <code>with</code>. In RSpec 3.2, we treat it as an arg splat, so you can now
use it anywhere in an argument list:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">(</span><span class="n">test_double</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">any_args</span><span class="p">)</span>
</code></pre>

<p>This would match calls like <code>test_double.message(1, 2)</code> or
<code>test_double.message(1, 2, 3, 4)</code>.</p>

<h3 id="mocks-mismatched-args-are-now-diffed">Mocks: Mismatched Args Are Now Diffed</h3>

<p>A big part of what has made RSpec's failure output so useful is the diff
that you get for failures from particular matchers. However, message
expectation failures have never included a diff. For example, consider
this failing message expectation:</p>

<pre class="highlight ruby"><code><span class="n">test_double</span> <span class="o">=</span> <span class="n">double</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test_double</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="sx">%w[ 1 2 3 4 ]</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">))</span>
<span class="n">test_double</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="sx">%w[ 1 2 5 4 ]</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">))</span>
</code></pre>

<p>In RSpec 3.1 and before, this failed with:</p>

<pre class="highlight plaintext"><code>Failure/Error: test_double.foo(%w[ 1 2 5 4 ].join("\n"))
  Double received :foo with unexpected arguments
    expected: ("1\n2\n3\n4")
         got: ("1\n2\n5\n4")
</code></pre>

<p>RSpec 3.2 now includes diffs in message expectation failures when
appropriate (generally when multi-line strings are involved or when
the pretty-print output of the objects are multi-line). In 3.2, this
fails with:</p>

<pre class="highlight plaintext"><code>Failure/Error: test_double.foo(%w[ 1 2 5 4 ].join("\n"))
  Double received :foo with unexpected arguments
    expected: ("1\n2\n3\n4")
         got: ("1\n2\n5\n4")
  Diff:
  @@ -1,5 +1,5 @@
   1
   2
  -3
  +5
   4
</code></pre>

<p>Thanks to Pete Higgins for <a href="https://github.com/rspec/rspec-mocks/issues/434">originally suggesting</a>
this feature, and for <a href="https://github.com/rspec/rspec-support/pull/36">extracting our differ</a>
from rspec-expectation to rspec-support, and thanks to Sam Phippen for
<a href="https://github.com/rspec/rspec-mocks/pull/751">updating rspec-mocks</a> to use
the newly available differ.</p>

<h3 id="mocks-verifying-doubles-can-be-named">Mocks: Verifying Doubles Can Be Named</h3>

<p>RSpec's <code>double</code> has always supported an optional name, which gets
used in message expectation failures. In RSpec 3.0, we added some new
test double types – <code>instance_double</code>, <code>class_double</code> and <code>object_double</code> –
and in 3.1, we added <code>instance_spy</code>, <code>class_spy</code> and <code>object_spy</code>…but
we forgot to support an optional name for these types.  In RSpec 3.2,
these double types now support an optional name. Just pass a second
argument (after the interface argument, but before any stubs):</p>

<pre class="highlight ruby"><code><span class="n">book_1</span> <span class="o">=</span> <span class="n">instance_double</span><span class="p">(</span><span class="no">Book</span><span class="p">,</span> <span class="s2">"The Brothers Karamozov"</span><span class="p">,</span> <span class="ss">author: </span><span class="s2">"Fyodor Dostoyevsky"</span><span class="p">)</span>
<span class="n">book_2</span> <span class="o">=</span> <span class="n">instance_double</span><span class="p">(</span><span class="no">Book</span><span class="p">,</span> <span class="s2">"Lord of the Rings"</span><span class="p">,</span> <span class="ss">author: </span><span class="s2">"J.R.R. Tolkien"</span><span class="p">)</span>
</code></pre>

<p>Thanks to Cezary Baginski for <a href="https://github.com/rspec/rspec-mocks/pull/826">implementing</a> this.</p>

<h3 id="rails-instance-doubles-support-dynamic-column-methods-defined-by-activerecord">Rails: Instance Doubles Support Dynamic Column Methods Defined by ActiveRecord</h3>

<p>ActiveRecord defines a number of methods on your model
class based on the column schema of the underlying table. This happens
dynamically the first time you call one of these methods. Unfortunately,
this led to confusing behavior when using an ActiveRecord-based <code>instance_double</code>: since
<code>User.method_defined?(:email)</code> returned <code>false</code> until a column method
was called for the first time, <code>instance_double(User)</code> would initially
not allow <code>email</code> to be stubbed until the column methods had been
dynamically defined.</p>

<p>We <a href="https://relishapp.com/rspec/rspec-mocks/v/3-1/docs/verifying-doubles/dynamic-classes">documented this
issue</a>
but it was still a source of frequent confusion with users. In RSpec
3.2, we've addressed this – we now force the model to define the
column methods when an ActiveRecord-based <code>instance_double</code> is created
so that the verified double works as expected.</p>

<p>Thanks to Jon Rowe for
<a href="https://github.com/rspec/rspec-rails/pull/1238">implementing</a> this improvement!</p>

<h3 id="rails-support-ruby-22-with-rails-32-and-4x">Rails: Support Ruby 2.2 with Rails 3.2 and 4.x</h3>

<p>Ruby 2.2 was released in December, and while most Ruby 2.1 code bases
work just fine on 2.2, there were a few changes the Rails core team
had to make to Rails to support 2.2. Likewise, Aaron Kromer has updated
rspec-rails to support Ruby 2.2 on <a href="https://github.com/rspec/rspec-rails/pull/1277">Rails
3.2</a> and <a href="https://github.com/rspec/rspec-rails/pull/1264">Rails
4.x</a>.</p>

<h3 id="rails-new-generator-for-actionmailer-previews">Rails: New Generator for ActionMailer Previews</h3>

<p>ActionMailer previews were one of the <a href="http://guides.rubyonrails.org/4_1_release_notes.html#action-mailer-previews">new
features</a> in Rails 4.1.
By default, Rails generates the preview classes in your <code>test</code>
directory. Since RSpec projects use <code>spec</code> instead of <code>test</code>,
this didn't integrate well with rspec-rails.</p>

<p>In 3.2, rspec-rails now ships with a generator that will put
ActionMailer preview classes in your <code>spec</code> directory, providing
the same functionality that Rails already provides to Test::Unit and
Minitest users.</p>

<p>Thanks to Takashi Nakagawa for the <a href="https://github.com/rspec/rspec-rails/pull/1185">initial
implementation</a>
and to Aaron Kromer for <a href="https://github.com/rspec/rspec-rails/pull/1236">further
improvements</a>.</p>

<h2 id="stats">Stats</h2>

<h3 id="combined">Combined:</h3>

<ul>
  <li><strong>Total Commits</strong>: 915</li>
  <li><strong>Merged pull requests</strong>: 278</li>
  <li><strong>54 contributors</strong>: Aaron Kromer, Akos Vandra, Alex Chaffee, Alex Genco, Alexey Fedorov, Andy Waite, Arlandis Lawrence, Avner Cohen, Ben Moss, Ben Snape, Benjamin Fleischer, Brian Kane, Cezary Baginski, ChaYoung You, Christian Nelson, Dennis Ideler, Durran Jordan, Elena Sharma, Elia Schito, Eliot Sykes, Fumiaki MATSUSHIMA, Griffin Smith, Guido Günther, Jim Kingdon, Jon Rowe, Jonathan, Jonathan Rochkind, Jori Hardman, Kevin Mook, Max Lincoln, Melanie Gilman, Michael Stock, Mike Dalton, Myron Marston, Peter Rhoades, Piotr Jakubowski, Postmodern, Rebecca Skinner, Ryan Fitzgerald, Sam Phippen, Scott Archer, Siva Gollapalli, Takashi Nakagawa, Thaddee Tyl, Thales Oliveira, Tim Wade, Tom Schady, Tom Stuart, Tony Novak, Xavier Shay, Yorick Peterse, Yuji Nakayama, dB, tyler-ball</li>
</ul>

<h3 id="rspec-core">rspec-core:</h3>

<ul>
  <li><strong>Total Commits</strong>: 364</li>
  <li><strong>Merged pull requests</strong>: 89</li>
  <li><strong>23 contributors</strong>: Aaron Kromer, Akos Vandra, Alex Chaffee, Alexey Fedorov, Arlandis Lawrence, Ben Moss, Ben Snape, Cezary Baginski, ChaYoung You, Christian Nelson, Durran Jordan, Fumiaki MATSUSHIMA, Guido Günther, Jim Kingdon, Jon Rowe, Jonathan Rochkind, Kevin Mook, Max Lincoln, Mike Dalton, Myron Marston, Sam Phippen, Tom Schady, tyler-ball</li>
</ul>

<h3 id="rspec-expectations">rspec-expectations:</h3>

<ul>
  <li><strong>Total Commits</strong>: 123</li>
  <li><strong>Merged pull requests</strong>: 45</li>
  <li><strong>14 contributors</strong>: Aaron Kromer, Alex Genco, Alexey Fedorov, Avner Cohen, Ben Moss, Elia Schito, Jon Rowe, Jonathan, Jori Hardman, Mike Dalton, Myron Marston, Postmodern, Siva Gollapalli, Tom Stuart</li>
</ul>

<h3 id="rspec-mocks">rspec-mocks:</h3>

<ul>
  <li><strong>Total Commits</strong>: 180</li>
  <li><strong>Merged pull requests</strong>: 61</li>
  <li><strong>17 contributors</strong>: Aaron Kromer, Andy Waite, Ben Moss, Cezary Baginski, Jon Rowe, Melanie Gilman, Myron Marston, Piotr Jakubowski, Ryan Fitzgerald, Sam Phippen, Siva Gollapalli, Tim Wade, Tom Schady, Tony Novak, Xavier Shay, Yorick Peterse, dB</li>
</ul>

<h3 id="rspec-rails">rspec-rails:</h3>

<ul>
  <li><strong>Total Commits</strong>: 136</li>
  <li><strong>Merged pull requests</strong>: 42</li>
  <li><strong>17 contributors</strong>: Aaron Kromer, Ben Moss, Brian Kane, Dennis Ideler, Elena Sharma, Eliot Sykes, Griffin Smith, Jon Rowe, Michael Stock, Myron Marston, Peter Rhoades, Rebecca Skinner, Sam Phippen, Takashi Nakagawa, Thaddee Tyl, Thales Oliveira, Yuji Nakayama</li>
</ul>

<h3 id="rspec-support">rspec-support:</h3>

<ul>
  <li><strong>Total Commits</strong>: 112</li>
  <li><strong>Merged pull requests</strong>: 41</li>
  <li><strong>10 contributors</strong>: Aaron Kromer, Alex Genco, Alexey Fedorov, Ben Moss, Benjamin Fleischer, Jon Rowe, Myron Marston, Sam Phippen, Scott Archer, Yorick Peterse</li>
</ul>

<h2 id="docs">Docs</h2>

<h3 id="api-docs">API Docs</h3>

<ul>
  <li><a href="/documentation/3.2/rspec-core/">rspec-core</a></li>
  <li><a href="/documentation/3.2/rspec-expectations/">rspec-expectations</a></li>
  <li><a href="/documentation/3.2/rspec-mocks/">rspec-mocks</a></li>
  <li><a href="/documentation/3.2/rspec-rails/">rspec-rails</a></li>
</ul>

<h3 id="cucumber-features">Cucumber Features</h3>

<ul>
  <li><a href="http://relishapp.com/rspec/rspec-core">rspec-core</a></li>
  <li><a href="http://relishapp.com/rspec/rspec-expectations">rspec-expectations</a></li>
  <li><a href="http://relishapp.com/rspec/rspec-mocks">rspec-mocks</a></li>
  <li><a href="http://relishapp.com/rspec/rspec-rails">rspec-rails</a></li>
</ul>

<h2 id="release-notes">Release Notes</h2>

<h3 id="rspec-core-320">rspec-core-3.2.0</h3>
<p><a href="http://github.com/rspec/rspec-core/compare/v3.1.7...v3.2.0">Full Changelog</a></p>

<p>Enhancements:</p>

<ul>
  <li>Improve the <code>inspect</code> output of example groups. (Mike Dalton, #1687)</li>
  <li>When rake task fails, only output the command if <code>verbose</code> flag is
set. (Ben Snape, #1704)</li>
  <li>Add <code>RSpec.clear_examples</code> as a clear way to reset examples in between
spec runs, whilst retaining user configuration.  (Alexey Fedorov, #1706)</li>
  <li>Reduce string allocations when defining and running examples by 70%
and 50% respectively. (Myron Marston, #1738)</li>
  <li>Removed dependency on pathname from stdlib. (Sam Phippen, #1703)</li>
  <li>Improve the message presented when a user hits Ctrl-C.
(Alex Chaffee #1717, #1742)</li>
  <li>Improve shared example group inclusion backtrace displayed
in failed example output so that it works for all methods
of including shared example groups and shows all inclusion
locations. (Myron Marston, #1763)</li>
  <li>Issue seed notification at start (as well as the end) of the reporter
run. (Arlandis Word, #1761)</li>
  <li>Improve the documentation of around hooks. (Jim Kingdon, #1772)</li>
  <li>Support prepending of modules into example groups from config and allow
filtering based on metadata. (Arlandis Word, #1806)</li>
  <li>Emit warnings when <code>:suite</code> hooks are registered on an example group
(where it has always been ignored) or are registered with metadata
(which has always been ignored). (Myron Marston, #1805)</li>
  <li>Provide a friendly error message when users call RSpec example group
APIs (e.g. <code>context</code>, <code>describe</code>, <code>it</code>, <code>let</code>, <code>before</code>, etc) from
within an example where those APIs are unavailable. (Myron Marston, #1819)</li>
  <li>Provide a friendly error message when users call RSpec example
APIs (e.g. <code>expect</code>, <code>double</code>, <code>stub_const</code>, etc) from
within an example group where those APIs are unavailable.
(Myron Marston, #1819)</li>
  <li>Add new <code>RSpec::Core::Sandbox.sandboxed { }</code> API that facilitates
testing RSpec with RSpec, allowing you to define example groups
and example from within an example without affecting the global
<code>RSpec.world</code> state. (Tyler Ball, 1808)</li>
  <li>Apply line-number filters only to the files they are scoped to,
allowing you to mix filtered and unfiltered files. (Myron Marston, #1839)</li>
  <li>When dumping pending examples, include the failure details so that you
don't have to un-pend the example to see it. (Myron Marston, #1844)</li>
  <li>Make <code>-I</code> option support multiple values when separated by
<code>File::PATH_SEPARATOR</code>, such as <code>rspec -I foo:bar</code>. This matches
the behavior of Ruby's <code>-I</code> option. (Fumiaki Matsushima, #1855).</li>
</ul>

<p>Bug Fixes:</p>

<ul>
  <li>When assigning generated example descriptions, surface errors
raised by <code>matcher.description</code> in the example description.
(Myron Marston, #1771)</li>
  <li>Don't consider expectations from <code>after</code> hooks when generating
example descriptions. (Myron Marston, #1771)</li>
  <li>Don't apply metadata-filtered config hooks to examples in groups
with matching metadata when those examples override the parent
metadata value to not match. (Myron Marston, #1796)</li>
  <li>Fix <code>config.expect_with :minitest</code> so that <code>skip</code> uses RSpec's
implementation rather than Minitest's. (Jonathan Rochkind, #1822)</li>
  <li>Fix <code>NameError</code> caused when duplicate example group aliases are defined and
the DSL is not globally exposed. (Aaron Kromer, #1825)</li>
  <li>When a shared example defined in an external file fails, use the host
example group (from a loaded spec file) for the re-run command to
ensure the command will actually work. (Myron Marston, #1835)</li>
  <li>Fix location filtering to work properly for examples defined in
a nested example group within a shared example group defined in
an external file. (Bradley Schaefer, Xavier Shay, Myron Marston, #1837)</li>
  <li>When a pending example fails (as expected) due to a mock expectation,
set <code>RSpec::Core::Example::ExecutionResult#pending_exception</code> –
previously it was not being set but should have been. (Myron Marston, #1844)</li>
  <li>Fix rake task to work when <code>rspec-core</code> is installed in a directory
containing a space. (Guido Günther, #1845)</li>
  <li>Fix regression in 3.1 that caused <code>describe Regexp</code> to raise errors.
(Durran Jordan, #1853)</li>
  <li>Fix regression in 3.x that caused the profile information to be printed
after the summary. (Max Lincoln, #1857)</li>
  <li>Apply <code>--seed</code> before loading <code>--require</code> files so that required files
can access the provided seed. (Myron Marston, #1745)</li>
  <li>Handle <code>RSpec::Core::Formatters::DeprecationFormatter::FileStream</code> being
reopened with an IO stream, which sometimes happens with spring.
(Kevin Mook, #1757)</li>
</ul>

<h3 id="rspec-expectations-320">rspec-expectations-3.2.0</h3>
<p><a href="http://github.com/rspec/rspec-expectations/compare/v3.1.2...v3.2.0">Full Changelog</a></p>

<p>Enhancements:</p>

<ul>
  <li>Add <code>block_arg</code> method to custom matcher API, which allows you to
access the block passed to a custom matcher, if there is one.
(Mike Dalton, #645)</li>
  <li>Provide more detail in failure message of <code>yield_control</code> matcher.
(Jon Rowe, #650)</li>
  <li>Add a shorthand syntax for <code>chain</code> in the matcher DSL which assigns values
for use elsewhere, for example <code>chain :and_smaller_than, :small_value</code>
creates an <code>attr_reader</code> for <code>small_value</code> (Tom Stuart, #644)</li>
  <li>Provide a more helpful deprecation message when using the <code>should</code> syntax.
(Elia Schito, #663)</li>
  <li>Provide more detail in the <code>have_attributes</code> matcher failure message.
(Jon Rowe,  #668)</li>
  <li>Make the <code>have_attributes</code> matcher diffable.
(Jon Rowe, Alexey Fedorov, #668)</li>
  <li>Add <code>output(...).to_std(out|err)_from_any_process</code> as alternatives
to <code>output(...).to_std(out|err)</code>. The latter doesn't work when a sub
process writes to the named stream but is much faster.
(Alex Genco, #700)</li>
  <li>Improve compound matchers (created by <code>and</code> and <code>or</code>) so that diffs
are included in failures when one or more of their matchers
are diffable. (Alexey Fedorov, #713)</li>
</ul>

<p>Bug Fixes:</p>

<ul>
  <li>Avoid calling <code>private_methods</code> from the <code>be</code> predicate matcher on
the target object if the object publicly responds to the predicate
method. This avoids a possible error that can occur if the object
raises errors from <code>private_methods</code> (which can happen with celluloid
objects). (@chapmajs, #670)</li>
  <li>Make <code>yield_control</code> (with no modifier) default to
<code>at_least(:once)</code> rather than raising a confusing error
when multiple yields are encountered.
(Myron Marston, #675)</li>
  <li>Fix "instance variable @color not initialized" warning when using
rspec-expectations outside of an rspec-core context. (Myron Marston, #689)</li>
  <li>Fix <code>start_with</code> and <code>end_with</code> to work properly when checking a
string against an array of strings. (Myron Marston, #690)</li>
  <li>Don't use internally delegated matchers when generating descriptions
for examples without doc strings. (Myron Marston, #692)</li>
</ul>

<h3 id="rspec-mocks-320">rspec-mocks-3.2.0</h3>
<p><a href="http://github.com/rspec/rspec-mocks/compare/v3.1.3...v3.2.0">Full Changelog</a></p>

<p>Enhancements:</p>

<ul>
  <li>Treat <code>any_args</code> as an arg splat, allowing it to match an arbitrary
number of args at any point in an arg list. (Myron Marston, #786)</li>
  <li>Print diffs when arguments in mock expectations are mismatched.
(Sam Phippen, #751)</li>
  <li>Support names for verified doubles (<code>instance_double</code>, <code>instance_spy</code>,
<code>class_double</code>, <code>class_spy</code>, <code>object_double</code>, <code>object_spy</code>). (Cezary
Baginski, #826)</li>
  <li>Make <code>array_including</code> and <code>hash_including</code> argument matchers composable.
(Sam Phippen, #819)</li>
  <li>Make <code>allow_any_instance_of(...).to receive(...).and_wrap_original</code>
work. (Ryan Fitzgerald, #869)</li>
</ul>

<p>Bug Fixes:</p>

<ul>
  <li>Provide a clear error when users wrongly combine <code>no_args</code> with
additional arguments (e.g. <code>expect().to receive().with(no_args, 1)</code>).
(Myron Marston, #786)</li>
  <li>Provide a clear error when users wrongly use <code>any_args</code> multiple times in the
same argument list (e.g. <code>expect().to receive().with(any_args, 1, any_args)</code>.
(Myron Marston, #786)</li>
  <li>Prevent the error generator from using user object #description methods.
See <a href="https://github.com/rspec/rspec-mocks/issues/685">#685</a>.
(Sam Phippen, #751)</li>
  <li>Make verified doubles declared as <code>(instance|class)_double(SomeConst)</code>
work properly when <code>SomeConst</code> has previously been stubbed.
<code>(instance|class)_double("SomeClass")</code> already worked properly.
(Myron Marston, #824)</li>
  <li>Add a matcher description for <code>receive</code>, <code>receive_messages</code> and
<code>receive_message_chain</code>. (Myron Marston, #828)</li>
  <li>Validate invocation args for null object verified doubles.
(Myron Marston, #829)</li>
  <li>Fix <code>RSpec::Mocks::Constant.original</code> when called with an invalid
constant to return an object indicating the constant name is invalid,
rather than blowing up. (Myron Marston, #833)</li>
  <li>Make <code>extend RSpec::Mocks::ExampleMethods</code> on any object work properly
to add the rspec-mocks API to that object. Previously, <code>expect</code> would
be undefined. (Myron Marston, #846)</li>
  <li>Fix <code>require 'rspec/mocks/standalone'</code> so that it only affects <code>main</code>
and not every object. It's really only intended to be used in a REPL
like IRB, but some gems have loaded it, thinking it needs to be loaded
when using rspec-mocks outside the context of rspec-core.
(Myron Marston, #846)</li>
  <li>Prevent message expectations from being modified by customization methods
(e.g. <code>with</code>) after they have been invoked. (Sam Phippen and Melanie Gilman, #837)</li>
  <li>Handle cases where a method stub cannot be removed due to something
external to RSpec monkeying with the method definition. This can
happen, for example, when you <code>file.reopen(io)</code> after previously
stubbing a method on the <code>file</code> object. (Myron Marston, #853)</li>
  <li>Provide a clear error when received message args are mutated before
a <code>have_received(...).with(...)</code> expectation. (Myron Marston, #868)</li>
</ul>

<h3 id="rspec-rails-320">rspec-rails-3.2.0</h3>
<p><a href="http://github.com/rspec/rspec-rails/compare/v3.1.0...v3.2.0">Full Changelog</a></p>

<p>Enhancements:</p>

<ul>
  <li>Include generator for <code>ActionMailer</code> mailer previews (Takashi Nakagawa, #1185)</li>
  <li>Configure the <code>ActionMailer</code> preview path via a Railtie (Aaron Kromer, #1236)</li>
  <li>Show all RSpec generators when running <code>rails generate</code> (Eliot Sykes, #1248)</li>
  <li>Support Ruby 2.2 with Rails 3.2 and 4.x (Aaron Kromer, #1264, #1277)</li>
  <li>Improve <code>instance_double</code> to support verifying dynamic column methods defined
by <code>ActiveRecord</code> (Jon Rowe, #1238)</li>
  <li>Mirror the use of Ruby 1.9 hash syntax for the <code>type</code> tags in the spec
generators on Rails 4. (Michael Stock, #1292)</li>
</ul>

<p>Bug Fixes:</p>

<ul>
  <li>Fix <code>rspec:feature</code> generator to use <code>RSpec</code> namespace preventing errors when
monkey-patching is disabled. (Rebecca Skinner, #1231)</li>
  <li>Fix <code>NoMethodError</code> caused by calling <code>RSpec.feature</code> when Capybara is not
available or the Capybara version is &lt; 2.4.0. (Aaron Kromer, #1261)</li>
  <li>Fix <code>ArgumentError</code> when using an anonymous controller which inherits an
outer group's anonymous controller. (Yuji Nakayama, #1260)</li>
  <li>Fix "Test is not a class (TypeError)" error when using a custom <code>Test</code> class
in Rails 4.1 and 4.2. (Aaron Kromer, #1295)</li>
</ul>

<h3 id="rspec-support-320">rspec-support-3.2.0</h3>
<p><a href="http://github.com/rspec/rspec-support/compare/v3.1.2...v3.2.0">Full Changelog</a></p>

<p>Enhancements:</p>

<ul>
  <li>Add extra Ruby type detection. (Jon Rowe, #133)</li>
  <li>Make differ instance re-usable. (Alexey Fedorov, #160)</li>
</ul>

<p>Bug Fixes:</p>

<ul>
  <li>Do not consider <code>[]</code> and <code>{}</code> to match when performing fuzzy matching.
(Myron Marston, #157)</li>
</ul>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname  = 'rspec';
  var disqus_identifier = '/blog/2015/02/rspec-3-2-has-been-released/';
  var disqus_title      = 'RSpec 3.2 has been released!';
  var disqus_url        = 'http://rspec.info/blog/2015/02/rspec-3-2-has-been-released/';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article></section><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59095215-1', 'auto');
  ga('send', 'pageview');

</script>
</body></html>