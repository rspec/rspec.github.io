<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: RSpec::Core::MemoizedHelpers::ClassMethods
    &mdash; Documentation by YARD 0.9.36
</title>
  <link rel="stylesheet" href="/documentation/3.13/rspec-core/css/style.css" type="text/css" />
  <link rel="stylesheet" href="/documentation/3.13/rspec-core/css/common.css" type="text/css" />
<script type="text/javascript">
  pathId = "RSpec::Core::MemoizedHelpers::ClassMethods";
  relpath = '../../../';
</script>
  <script type="text/javascript" charset="utf-8" src="/documentation/3.13/rspec-core/js/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="/documentation/3.13/rspec-core/js/app.js"></script>
  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>
    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
    <a href="../../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Core.html" title="RSpec::Core (module)">Core</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../MemoizedHelpers.html" title="RSpec::Core::MemoizedHelpers (module)">MemoizedHelpers</a></span></span>
     &raquo; 
    <span class="title">ClassMethods</span>
</div>
        <div id="search">
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
</div>
        <div class="clear"></div>
      </div>
      <div id="content"><h1>Module: RSpec::Core::MemoizedHelpers::ClassMethods
</h1>
<div class="box_info">
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../ExampleGroup.html" title="RSpec::Core::ExampleGroup (class)">ExampleGroup</a></span></dd>
  </dl>
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/rspec/core/memoized_helpers.rb</dd>
  </dl>
</div>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>This module is extended onto <span class='object_link'><a href="../ExampleGroup.html" title="RSpec::Core::ExampleGroup (class)">ExampleGroup</a></span>, making the methods
available to be called from within example group blocks.
You can think of them as being analagous to class macros.</p>
  </div>
</div>
<div class="tags">
</div>
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>
    <ul class="summary">
        <li class="public ">
  <span class="summary_signature">
      <a href="#let-instance_method" title="#let (instance method)">#<strong>let</strong>(name, &amp;block)  &#x21d2; void </a>
  </span>
    <span class="summary_desc"><div class='inline'><p>Generates a method whose return value is memoized after the first call.</p>
</div></span>
</li>
        <li class="public ">
  <span class="summary_signature">
      <a href="#let!-instance_method" title="#let! (instance method)">#<strong>let!</strong>(name, &amp;block)  &#x21d2; void </a>
  </span>
    <span class="summary_desc"><div class='inline'><p>Just like <code>let</code>, except the block is invoked by an implicit <code>before</code> hook.</p>
</div></span>
</li>
        <li class="public ">
  <span class="summary_signature">
      <a href="#subject-instance_method" title="#subject (instance method)">#<strong>subject</strong>(name = nil, &amp;block)  &#x21d2; void </a>
  </span>
    <span class="summary_desc"><div class='inline'><p>Declares a <code>subject</code> for an example group which can then be wrapped with <code>expect</code> using <code>is_expected</code> to make it the target of an expectation in a concise, one-line example.</p>
</div></span>
</li>
        <li class="public ">
  <span class="summary_signature">
      <a href="#subject!-instance_method" title="#subject! (instance method)">#<strong>subject!</strong>(name = nil, &amp;block)  &#x21d2; void </a>
  </span>
    <span class="summary_desc"><div class='inline'><p>Just like <code>subject</code>, except the block is invoked by an implicit <code>before</code> hook.</p>
</div></span>
</li>
    </ul>
  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
      <div class="method_details first">
  <h3 class="signature first" id="let-instance_method">
    #<strong>let</strong>(name, &amp;block)  &#x21d2; <tt>void</tt> 
</h3><div class="docstring">
  <div class="discussion">
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p><code>let</code> <em>can</em> enhance readability when used sparingly (1,2, or
maybe 3 declarations) in any given example group, but that can
quickly degrade with overuse. YMMV.</p>
</div>
  </div>
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p><code>let</code> can be configured to be threadsafe or not.
If it is threadsafe, it will take longer to access the value.
If it is not threadsafe, it may behave in surprising ways in examples
that spawn separate threads. Specify this on <code>RSpec.configure</code></p>
</div>
  </div>
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Because <code>let</code> is designed to create state that is reset between
each example, and <code>before(:context)</code> is designed to setup state that
is shared across <em>all</em> examples in an example group, <code>let</code> is <em>not</em>
intended to be used in a <code>before(:context)</code> hook.</p>
</div>
  </div>
<p>Generates a method whose return value is memoized after the first
call. Useful for reducing duplication between examples that assign
values to the same local variable.</p>
  </div>
</div>
<div class="tags">
  <div class="examples">
    <p class="tag_title">Examples:</p>
      <pre class="example code"><code>
<span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:thing</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>does something</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='comment'># First invocation, executes block, memoizes and returns result.
</span>    <span class='id identifier rubyid_thing'>thing</span><span class='period'>.</span><span class='id identifier rubyid_do_something'>do_something</span>
    <span class='comment'># Second invocation, returns the memoized value.
</span>    <span class='id identifier rubyid_thing'>thing</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_be_something'>be_something</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rspec/core/memoized_helpers.rb', line 306</span>
<span class='kw'>def</span> <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='comment'># We have to pass the block directly to `define_method` to
</span>  <span class='comment'># allow it to use method constructs like `super` and `return`.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#let or #subject called without a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='comment'># A list of reserved words that can&#39;t be used as a name for a memoized helper
</span>  <span class='comment'># Matches for both symbols and passed strings
</span>  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='symbol'>:initialize</span><span class='comma'>,</span> <span class='symbol'>:to_s</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#let or #subject called with reserved name `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_our_module'>our_module</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../MemoizedHelpers.html" title="RSpec::Core::MemoizedHelpers (module)">MemoizedHelpers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_module_for'>module_for</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='comment'># If we have a module clash in our helper module
</span>  <span class='comment'># then we need to remove it to prevent a warning.
</span>  <span class='comment'>#
</span>  <span class='comment'># Note we do not check ancestor modules (see: `instance_methods(false)`)
</span>  <span class='comment'># as we can override them.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_our_module'>our_module</span><span class='period'>.</span><span class='id identifier rubyid_instance_methods'>instance_methods</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_our_module'>our_module</span><span class='period'>.</span><span class='id identifier rubyid___send__'>__send__</span><span class='lparen'>(</span><span class='symbol'>:remove_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_our_module'>our_module</span><span class='period'>.</span><span class='id identifier rubyid___send__'>__send__</span><span class='lparen'>(</span><span class='symbol'>:define_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='comment'># If we have a module clash in the example module
</span>  <span class='comment'># then we need to remove it to prevent a warning.
</span>  <span class='comment'>#
</span>  <span class='comment'># Note we do not check ancestor modules (see: `instance_methods(false)`)
</span>  <span class='comment'># as we can override them.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_instance_methods'>instance_methods</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_remove_method'>remove_method</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='comment'># Apply the memoization. The method has been defined in an ancestor
</span>  <span class='comment'># module so we can use `super` here to get the value.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid___memoized'>__memoized</span><span class='period'>.</span><span class='id identifier rubyid_fetch_or_store'>fetch_or_store</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='kw'>super</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_example'><span class='object_link'><a href="../../../RSpec.html#current_example-class_method" title="RSpec.current_example (method)">current_example</a></span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid___memoized'>__memoized</span><span class='period'>.</span><span class='id identifier rubyid_fetch_or_store'>fetch_or_store</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='kw'>super</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
      <div class="method_details ">
  <h3 class="signature " id="let!-instance_method">
    #<strong>let!</strong>(name, &amp;block)  &#x21d2; <tt>void</tt> 
</h3><div class="docstring">
  <div class="discussion">
    <p>Just like <code>let</code>, except the block is invoked by an implicit <code>before</code>
hook. This serves a dual purpose of setting up state and providing a
memoized reference to that state.</p>
  </div>
</div>
<div class="tags">
  <div class="examples">
    <p class="tag_title">Examples:</p>
      <pre class="example code"><code>
<span class='kw'>class</span> <span class='const'>Thing</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
    <span class='ivar'>@count</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_count='>count=</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='ivar'>@count</span> <span class='op'>+=</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_count'>reset_count</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_after'>after</span><span class='lparen'>(</span><span class='symbol'>:example</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_reset_count'>reset_count</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using let</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:thing</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is not invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can be invoked explicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_thing'>thing</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using let!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_let!'>let!</span><span class='lparen'>(</span><span class='symbol'>:thing</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns memoized version on first invocation</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_thing'>thing</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">
400
401
402
403</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rspec/core/memoized_helpers.rb', line 400</span>
<span class='kw'>def</span> <span class='id identifier rubyid_let!'>let!</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_before'>before</span> <span class='lbrace'>{</span> <span class='id identifier rubyid___send__'>__send__</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
      <div class="method_details ">
  <h3 class="signature " id="subject-instance_method">
    #<strong>subject</strong>(name = nil, &amp;block)  &#x21d2; <tt>void</tt> 
</h3><div class="docstring">
  <div class="discussion">
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p><code>subject</code> can be configured to be threadsafe or not.
If it is threadsafe, it will take longer to access the value.
If it is not threadsafe, it may behave in surprising ways in examples
that spawn separate threads. Specify this on <code>RSpec.configure</code></p>
</div>
  </div>
<p>Declares a <code>subject</code> for an example group which can then be wrapped
with <code>expect</code> using <code>is_expected</code> to make it the target of an
expectation in a concise, one-line example.</p>
<p>Given a <code>name</code>, defines a method with that name which returns the
<code>subject</code>. This lets you declare the subject once and access it
implicitly in one-liners and explicitly using an intention revealing
name.</p>
<p>When given a <code>name</code>, calling <code>super</code> in the block is not supported.</p>
  </div>
</div>
<div class="tags">
  <div class="examples">
    <p class="tag_title">Examples:</p>
      <pre class="example code"><code>
<span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_describe'>describe</span> <span class='const'>CheckingAccount</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>with $50</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_subject'>subject</span> <span class='lbrace'>{</span> <span class='const'>CheckingAccount</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Money</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:USD</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_it'>it</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_is_expected'>is_expected</span><span class='period'>.</span><span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_have_a_balance_of'>have_a_balance_of</span><span class='lparen'>(</span><span class='const'>Money</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:USD</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_it'>it</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_is_expected'>is_expected</span><span class='period'>.</span><span class='id identifier rubyid_not_to'>not_to</span> <span class='id identifier rubyid_be_overdrawn'>be_overdrawn</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_describe'>describe</span> <span class='const'>CheckingAccount</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>with a non-zero starting balance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_subject'>subject</span><span class='lparen'>(</span><span class='symbol'>:account</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>CheckingAccount</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Money</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:USD</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_it'>it</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_is_expected'>is_expected</span><span class='period'>.</span><span class='id identifier rubyid_not_to'>not_to</span> <span class='id identifier rubyid_be_overdrawn'>be_overdrawn</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has a balance equal to the starting balance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_balance'>balance</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='const'>Money</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:USD</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
    <li>
        <span class='name'>name</span>
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
        <em class="default">(defaults to: <tt>nil</tt>)</em>
        &mdash;
        <div class='inline'><p>used to define an accessor with an
intention revealing name</p>
</div>
    </li>
    <li>
        <span class='name'>block</span>
        <span class='type'></span>
        &mdash;
        <div class='inline'><p>defines the value to be returned by <code>subject</code> in examples</p>
</div>
    </li>
</ul>
  <p class="tag_title">See Also:</p>
  <ul class="see">
      <li><span class='object_link'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">RSpec::Core::MemoizedHelpers#should</a></span></li>
      <li><span class='object_link'><a href="../MemoizedHelpers.html#should_not-instance_method" title="RSpec::Core::MemoizedHelpers#should_not (method)">RSpec::Core::MemoizedHelpers#should_not</a></span></li>
      <li><span class='object_link'><a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">RSpec::Core::MemoizedHelpers#is_expected</a></span></li>
  </ul>
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">
444
445
446
447
448
449
450
451
452
453
454
455</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rspec/core/memoized_helpers.rb', line 444</span>
<span class='kw'>def</span> <span class='id identifier rubyid_subject'>subject</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:subject</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>
    <span class='kw'>self</span><span class='op'>::</span><span class='const'>NamedSubjectPreventSuper</span><span class='period'>.</span><span class='id identifier rubyid___send__'>__send__</span><span class='lparen'>(</span><span class='symbol'>:define_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`super` in named subjects is not supported</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:subject</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
      <div class="method_details ">
  <h3 class="signature " id="subject!-instance_method">
    #<strong>subject!</strong>(name = nil, &amp;block)  &#x21d2; <tt>void</tt> 
</h3><div class="docstring">
  <div class="discussion">
    <p>Just like <code>subject</code>, except the block is invoked by an implicit
<code>before</code> hook. This serves a dual purpose of setting up state and
providing a memoized reference to that state.</p>
  </div>
</div>
<div class="tags">
  <div class="examples">
    <p class="tag_title">Examples:</p>
      <pre class="example code"><code>
<span class='kw'>class</span> <span class='const'>Thing</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
    <span class='ivar'>@count</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_count='>count=</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='ivar'>@count</span> <span class='op'>+=</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_count'>reset_count</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='const'><span class='object_link'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_after'>after</span><span class='lparen'>(</span><span class='symbol'>:example</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_reset_count'>reset_count</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using subject</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_subject'>subject</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is not invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can be invoked explicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_subject'>subject</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using subject!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_subject!'>subject!</span><span class='lparen'>(</span><span class='symbol'>:thing</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns memoized version on first invocation</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_subject'>subject</span>
      <span class='const'>Thing</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">
510
511
512
513</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rspec/core/memoized_helpers.rb', line 510</span>
<span class='kw'>def</span> <span class='id identifier rubyid_subject!'>subject!</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_subject'>subject</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_before'>before</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_subject'>subject</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  </div>
</div>
      <div id="footer">
  Generated on Tue Sep  3 11:00:23 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.2.2).
</div>
    </div>
  </body>
</html>